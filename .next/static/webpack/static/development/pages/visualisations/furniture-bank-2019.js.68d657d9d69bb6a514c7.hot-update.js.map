{"version":3,"file":"static/webpack/static/development/pages/visualisations/furniture-bank-2019.js.68d657d9d69bb6a514c7.hot-update.js","sources":["webpack:///./containers/FurnitureBank2019/components/Map/MapContent.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport ReactMapGL from \"react-map-gl\";\n\nimport { MapContainer } from \"../../styles/styledContainers\";\nimport { ChartPaper, ChartTitle } from \"../../styles/styledElements\";\nimport { HEATMAP_SOURCE_ID, heatMapStyles } from \"./mapStyles\";\nimport { useSelector } from \"react-redux\";\nimport { selectFilteredCoordinates } from \"../../../../store/furnitureBankReducer/selectors\";\nimport { config } from \"../../../../config\";\nimport { Message } from \"..\";\n\nconst initialViewport = {\n  latitude: 43.702702563904154,\n  longitude: -79.5290090619582,\n  zoom: 9.070378236162412\n};\n\nconst MapContent = () => {\n  const filteredCoordinates = useSelector(selectFilteredCoordinates);\n  const [initMap, setInitMap] = useState(false);\n  const [viewport, setViewPort] = useState(initialViewport);\n  const mapRef = useRef();\n\n  const handleMapLoaded = () => {\n    mapRef.current.getMap().addSource(HEATMAP_SOURCE_ID, {\n      type: \"geojson\",\n      data: makeGeoJSON(filteredCoordinates)\n    });\n    mapRef.current.getMap().addLayer(heatMapStyles);\n    setInitMap(true);\n  };\n\n  useEffect(() => {\n    if (initMap) {\n      mapRef.current\n        .getMap()\n        .getSource(HEATMAP_SOURCE_ID)\n        .setData(makeGeoJSON(filteredCoordinates));\n    }\n  }, [filteredCoordinates, initMap]);\n\n  const makeGeoJSON = data => {\n    if (!data) return undefined;\n    return {\n      type: \"FeatureCollection\",\n      features: data.map(feature => {\n        return {\n          type: \"Feature\",\n          properties: {\n            id: feature.postal_code\n          },\n          geometry: {\n            type: \"Point\",\n            coordinates: feature.coors\n              ? [feature.coors.longitude, feature.coors.latitude, 0]\n              : [0, 0, 0]\n          }\n        };\n      })\n    };\n  };\n\n  return (\n    <MapContainer>\n      <ChartPaper>\n        <ChartTitle withBG>\n          In Which areas will your donated furniture be received?\n        </ChartTitle>\n        <Message noData withBG/>\n        <ReactMapGL\n          ref={mapRef}\n          mapboxApiAccessToken={config.MAP_API}\n          {...viewport}\n          width=\"100%\"\n          height=\"100%\"\n          onViewportChange={viewport => setViewPort({ ...viewport })}\n          mapStyle=\"mapbox://styles/szeandr/ck1f4skvt0xyl1ct93ti7k1s6\"\n          onLoad={handleMapLoaded}\n        ></ReactMapGL>\n      </ChartPaper>\n    </MapContainer>\n  );\n};\n\nexport default MapContent;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;AACA;AAKA;AACA;AACA;AAFA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAFA;AALA;AAYA;AAfA;AAiBA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AAAA;AACA;AACA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AACA;AACA;;;;A","sourceRoot":""}